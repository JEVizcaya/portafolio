<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat Mobile Responsive</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/chat.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-controls {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 20000;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #444;
        }
        
        .test-btn {
            background: #ffd700;
            color: #1a1a1a;
            border: none;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .viewport-info {
            position: fixed;
            top: 10px;
            right: 120px;
            z-index: 20000;
            background: #333;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .content {
            max-width: 800px;
            margin: 80px auto 0;
            line-height: 1.6;
        }
        
        .simulated-header {
            height: 60px;
            background: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            position: relative;
        }
        
        .back-to-top {
            position: fixed;
            top: 120px;
            right: 25px;
            width: 50px;
            height: 50px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffd700;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div class="test-controls">
        <h4 style="margin: 0 0 10px 0; font-size: 14px;">Test Controls</h4>
        <button class="test-btn" onclick="setViewport(375, 667)">iPhone SE</button>
        <button class="test-btn" onclick="setViewport(390, 844)">iPhone 12</button>
        <button class="test-btn" onclick="setViewport(414, 896)">iPhone 14+</button>
        <button class="test-btn" onclick="setViewport(768, 1024)">iPad</button>
        <button class="test-btn" onclick="setViewport(1024, 768)">iPad Landscape</button>
        <button class="test-btn" onclick="setViewport(1200, 800)">Desktop</button>
        <br><br>        <button class="test-btn" onclick="toggleChat()">Toggle Chat</button>
        <button class="test-btn" onclick="simulateOrientation()">Rotate</button>
        <button class="test-btn" onclick="testCloseOnOutsideClick()">Test Outside Click</button>
        <button class="test-btn" onclick="testOverlayClick()">Test Overlay</button>
    </div>
    
    <div class="viewport-info" id="viewportInfo">
        Viewport: <span id="viewportSize"></span>
    </div>
    
    <div class="simulated-header">
        <h1>Portfolio Header</h1>
    </div>
    
    <div class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>
    
    <div class="content">
        <h2>Test Content for Mobile Responsive Chat</h2>
        <p>Este es contenido de prueba para evaluar el comportamiento del chat en diferentes tamaños de pantalla.</p>
        
        <h3>Instrucciones de Prueba:</h3>
        <ol>
            <li><strong>Cambiar tamaño de viewport:</strong> Usa los botones superiores para simular diferentes dispositivos</li>
            <li><strong>Abrir chat:</strong> Haz clic en el botón dorado flotante</li>
            <li><strong>Probar cierre:</strong> 
                <ul>
                    <li>Clic en X del header</li>
                    <li>Clic fuera del chat</li>
                    <li>Tecla Escape</li>
                    <li>Swipe hacia abajo (móviles)</li>
                </ul>
            </li>
            <li><strong>Orientación:</strong> Usa "Rotate" para simular cambio de orientación</li>
            <li><strong>Enviar mensajes:</strong> Prueba el funcionamiento completo</li>
        </ol>
        
        <h3>Problemas a Verificar:</h3>
        <ul>
            <li>Chat no se cierra correctamente en móviles</li>
            <li>Posicionamiento incorrecto después de cambio de orientación</li>
            <li>Overlay no funciona apropiadamente</li>
            <li>Animaciones no son fluidas</li>
            <li>Scroll del body no se restaura</li>
        </ul>
        
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        
        <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        
        <div style="height: 1000px; background: linear-gradient(to bottom, #2a2a2a, #1a1a1a); margin: 20px 0; display: flex; align-items: center; justify-content: center;">
            <p>Contenido adicional para probar scroll</p>
        </div>
        
        <p>Contenido final para verificar que el scroll funciona correctamente cuando el chat está abierto.</p>
    </div>
    
    <!-- Chat HTML Structure -->
    <div id="chat-toggle" class="chat-toggle">
        <i class="fas fa-comments"></i>
    </div>
    
    <div id="chat-container" class="chat-container">
        <div class="chat-header">
            <div class="chat-header-content">
                <div class="chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chat-info">
                    <h4>Asistente Virtual</h4>
                    <div class="chat-status">En línea</div>
                </div>
            </div>
            <button id="chat-close" class="chat-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="chat-messages" class="chat-messages">
            <!-- Los mensajes se insertan aquí dinámicamente -->
        </div>
        
        <div id="chat-typing" class="chat-typing" style="display: none;">
            <span></span>
            <span></span>
            <span></span>
            Escribiendo...
        </div>
        
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea 
                    id="chat-input" 
                    placeholder="Escribe tu mensaje..."
                    rows="1"
                ></textarea>
                <button id="chat-send" class="chat-send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Chat Overlay for mobile -->
    <div id="chat-overlay" class="chat-overlay"></div>
    
    <script>
        // Test utilities
        function setViewport(width, height) {
            // Simulate viewport change
            document.documentElement.style.width = width + 'px';
            document.documentElement.style.height = height + 'px';
            document.body.style.width = width + 'px';
            document.body.style.minHeight = height + 'px';
            
            // Update viewport info
            updateViewportInfo();
            
            // Trigger resize event
            window.dispatchEvent(new Event('resize'));
            
            console.log(`Viewport set to: ${width}x${height}`);
        }
        
        function updateViewportInfo() {
            const width = window.innerWidth || document.documentElement.clientWidth;
            const height = window.innerHeight || document.documentElement.clientHeight;
            document.getElementById('viewportSize').textContent = `${width}x${height}`;
        }
        
        function toggleChat() {
            if (window.portfolioChat) {
                window.portfolioChat.toggleChat();
            }
        }
        
        function simulateOrientation() {
            const currentWidth = parseInt(document.documentElement.style.width) || window.innerWidth;
            const currentHeight = parseInt(document.documentElement.style.height) || window.innerHeight;
            
            // Swap dimensions
            setViewport(currentHeight, currentWidth);
            
            // Trigger orientation change event
            setTimeout(() => {
                window.dispatchEvent(new Event('orientationchange'));
            }, 100);
        }
          function testCloseOnOutsideClick() {
            // Open chat first
            if (window.portfolioChat && !window.portfolioChat.isOpen) {
                window.portfolioChat.openChat();
            }
            
            // Then simulate click outside
            setTimeout(() => {
                const outsideElement = document.querySelector('.content');
                outsideElement.click();
                console.log('Simulated click outside chat');
            }, 500);
        }
        
        function testOverlayClick() {
            // Open chat first
            if (window.portfolioChat && !window.portfolioChat.isOpen) {
                window.portfolioChat.openChat();
            }
            
            // Then simulate overlay click
            setTimeout(() => {
                const overlay = document.getElementById('chat-overlay');
                if (overlay) {
                    overlay.click();
                    console.log('Simulated overlay click');
                } else {
                    console.log('Overlay not found');
                }
            }, 500);
        }
        
        // Initialize viewport info
        updateViewportInfo();
        window.addEventListener('resize', updateViewportInfo);
        
        // Enhanced logging for debugging
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, ['[TEST]', ...args]);
        };
          // Monitor chat state changes
        function monitorChatState() {
            const chatContainer = document.getElementById('chat-container');
            const chatOverlay = document.getElementById('chat-overlay');
            
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const isActive = chatContainer.classList.contains('active');
                        const overlayActive = chatOverlay ? chatOverlay.classList.contains('active') : false;
                        
                        console.log('Chat state changed:', isActive ? 'OPEN' : 'CLOSED');
                        console.log('Container classes:', chatContainer.className);
                        console.log('Overlay classes:', chatOverlay ? chatOverlay.className : 'No overlay');
                        console.log('Body overflow:', document.body.style.overflow);
                        console.log('Body classes:', document.body.className);
                        console.log('Is mobile:', window.innerWidth <= 768);
                    }
                });
            });
            
            observer.observe(chatContainer, {
                attributes: true,
                attributeFilter: ['class']
            });
            
            // Also monitor overlay if it exists
            if (chatOverlay) {
                observer.observe(chatOverlay, {
                    attributes: true,
                    attributeFilter: ['class']
                });
            }
        }
        
        // Start monitoring when chat is initialized
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(monitorChatState, 1000);
        });
    </script>
    
    <script src="assets/js/chat.js"></script>
</body>
</html>
